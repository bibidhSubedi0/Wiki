@model NoteWiki.Models.NoteContentModel

<div class="note-container">
    <h2>@Model.NoteName</h2>

    <!-- Viewing Mode -->
    <div id="viewMode">
        <div class="note-content">
            @Html.Raw(Model.Content)
        </div>
        <button type="button" id="editBtn">Edit</button>
        <button type="button" onclick="window.history.back()">Back</button>
        <a asp-action="DeleteNote" asp-controller="Note" asp-route-NoteGuid="@Model.NoteGuid" asp-route-NoteBoxGuid="@ViewBag.NoteBoxGuid">
            Delete This note
        </a>
    </div>

    <!-- Editing Mode (hidden by default) -->
    <div id="editMode" style="display:none;">
        <form asp-action="Edit" asp-controller="Note" method="post">
            <input type="hidden" name="NoteGuid" value="@Model.NoteGuid" />
            <input type="text" name="NoteName" value="@Model.NoteName" />

            <div id="editor"></div>
            <input type="hidden" name="Content" id="hiddenContent" />

            <button type="submit">Save</button>
            <button type="button" id="cancelBtn">Cancel</button>
        </form>
    </div>
</div>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var quill;

        const editBtn = document.getElementById("editBtn");
        const cancelBtn = document.getElementById("cancelBtn");
        const viewMode = document.getElementById("viewMode");
        const editMode = document.getElementById("editMode");
        const hiddenContent = document.getElementById("hiddenContent");

        editBtn.addEventListener("click", function () {
            viewMode.style.display = "none";
            editMode.style.display = "block";

            if (!quill) {
                quill = new Quill('#editor', { theme: 'snow' });
                quill.root.innerHTML = `@Html.Raw(Model.Content)`;
            }
        });

        cancelBtn.addEventListener("click", function () {
            editMode.style.display = "none";
            viewMode.style.display = "block";
        });

        document.querySelector("#editMode form").addEventListener("submit", function () {
            hiddenContent.value = quill.root.innerHTML;
        });
    });
</script>
